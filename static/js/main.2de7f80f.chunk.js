(this.webpackJsonpcomp=this.webpackJsonpcomp||[]).push([[0],{24:function(e,t,n){},25:function(e,t,n){},35:function(e,t,n){"use strict";function r(e){function t(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+" in simple mode")}function n(e,t){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((!1===t?"":"^")+"(?:"+e+")",n)}function r(e,r){(e.next||e.push)&&t(r,e.next||e.push),this.regex=n(e.regex),this.token=function(e){if(!e)return null;if(e.apply)return e;if("string"==typeof e)return e.replace(/\./g," ");for(var t=[],n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}(e.token),this.data=e}function a(e,t){return function(n,r){if(r.pending){var a=r.pending.shift();return 0==r.pending.length&&(r.pending=null),n.pos+=a.text.length,a.token}if(r.local){if(r.local.end&&n.match(r.local.end)){var i=r.local.endToken||null;return r.local=r.localState=null,i}var o;i=r.local.mode.token(n,r.localState);return r.local.endScan&&(o=r.local.endScan.exec(n.current()))&&(n.pos=n.start+o.index),i}for(var l=e[r.state],u=0;u<l.length;u++){var c=l[u],d=(!c.data.sol||n.sol())&&n.match(c.regex);if(d){c.data.next?r.state=c.data.next:c.data.push?((r.stack||(r.stack=[])).push(r.state),r.state=c.data.push):c.data.pop&&r.stack&&r.stack.length&&(r.state=r.stack.pop()),c.data.mode&&s(t,r,c.data.mode,c.token),c.data.indent&&r.indent.push(n.indentation()+t.indentUnit),c.data.dedent&&r.indent.pop();var f=c.token;if(f&&f.apply&&(f=f(d)),d.length>2&&c.token&&"string"!=typeof c.token){r.pending=[];for(var p=2;p<d.length;p++)d[p]&&r.pending.push({text:d[p],token:c.token[p-1]});return n.backUp(d[0].length-(d[1]?d[1].length:0)),f[0]}return f&&f.join?f[0]:f}}return n.next(),null}}function i(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;var n=0;for(var r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r)||!i(e[r],t[r]))return!1;n++}for(var r in t)t.hasOwnProperty(r)&&n--;return 0==n}function s(t,r,a,s){var o;if(a.persistent)for(var l=r.persistentStates;l&&!o;l=l.next)(a.spec?i(a.spec,l.spec):a.mode==l.mode)&&(o=l);var u=o?o.mode:a.mode||e.getMode(t,a.spec),c=o?o.state:e.startState(u);a.persistent&&!o&&(r.persistentStates={mode:u,spec:a.spec,state:c,next:r.persistentStates}),r.localState=c,r.local={mode:u,end:a.end&&n(a.end),endScan:a.end&&!1!==a.forceEnd&&n(a.end,!1),endToken:s&&s.join?s[s.length-1]:s}}function o(t,n){return function(r,a,i){if(r.local&&r.local.mode.indent)return r.local.mode.indent(r.localState,a,i);if(null==r.indent||r.local||n.dontIndentStates&&function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0}(r.state,n.dontIndentStates)>-1)return e.Pass;var s=r.indent.length-1,o=t[r.state];e:for(;;){for(var l=0;l<o.length;l++){var u=o[l];if(u.data.dedent&&!1!==u.data.dedentIfLineStart){var c=u.regex.exec(a);if(c&&c[0]){s--,(u.next||u.push)&&(o=t[u.next||u.push]),a=a.slice(c[0].length);continue e}}}break}return s<0?0:r.indent[s]}}e.defineSimpleMode=function(t,n){e.defineMode(t,(function(t){return e.simpleMode(t,n)}))},e.simpleMode=function(n,i){t(i,"start");var s={},l=i.meta||{},u=!1;for(var c in i)if(c!=l&&i.hasOwnProperty(c))for(var d=s[c]=[],f=i[c],p=0;p<f.length;p++){var h=f[p];d.push(new r(h,i)),(h.indent||h.dedent)&&(u=!0)}var g={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:u?[]:null}},copyState:function(t){var n={state:t.state,pending:t.pending,local:t.local,localState:null,indent:t.indent&&t.indent.slice(0)};t.localState&&(n.localState=e.copyState(t.local.mode,t.localState)),t.stack&&(n.stack=t.stack.slice(0));for(var r=t.persistentStates;r;r=r.next)n.persistentStates={mode:r.mode,spec:r.spec,state:r.state==t.localState?n.localState:e.copyState(r.mode,r.state),next:n.persistentStates};return n},token:a(s,n),innerMode:function(e){return e.local&&{mode:e.local.mode,state:e.localState}},indent:o(s,l)};if(l)for(var m in l)l.hasOwnProperty(m)&&(g[m]=l[m]);return g}}n.r(t),n.d(t,"addDefineSimpleMode",(function(){return r}))},36:function(e,t,n){"use strict";n.r(t);var r,a=n(2),i=n.n(a),s=n(15),o=n.n(s),l=(n(24),n(19)),u=n(17),c=n(4),d=n(18),f=n(3),p=n(11),h=n(12),g=(n(25),n(16)),m=(n(27),n(28),n(29),n(7)),b=n.n(m),v=n(14),_=n(9),w=n.n(_),y=n(13),k=new Array(32).fill(void 0);function j(e){return k[e]}k.push(void 0,null,!0,!1);var x=k.length;function S(e){var t=j(e);return function(e){e<36||(k[e]=x,x=e)}(e),t}var O=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});O.decode();var T=null;function A(){return null!==T&&T.buffer===r.memory.buffer||(T=new Uint8Array(r.memory.buffer)),T}function N(e,t){return O.decode(A().subarray(e,e+t))}var M=null;function L(){return null!==M&&M.buffer===r.memory.buffer||(M=new Uint32Array(r.memory.buffer)),M}var I=0;function C(e){if("number"!==typeof e)throw new Error("expected a number argument")}var z=null;function E(){return null!==z&&z.buffer===r.memory.buffer||(z=new Int32Array(r.memory.buffer)),z}function P(e,t,n,a){try{var i=r.__wbindgen_add_to_stack_pointer(-16),s=function(e,t){var n=t(4*e.length);return L().set(e,n/4),I=e.length,n}(e,r.__wbindgen_malloc),o=I;C(t),C(n),C(a),r.perform_simulation(i,s,o,t,n,a);var l=E()[i/4+0],u=E()[i/4+1],c=(d=l,f=u,A().subarray(d/1,d/1+f)).slice();return r.__wbindgen_free(l,1*u),c}finally{r.__wbindgen_add_to_stack_pointer(16)}var d,f}function R(){try{var e=r.__wbindgen_add_to_stack_pointer(-16);r.get_indices(e);var t=E()[e/4+0],n=E()[e/4+1],a=(i=t,s=n,L().subarray(i/4,i/4+s)).slice();return r.__wbindgen_free(t,4*n),a}finally{r.__wbindgen_add_to_stack_pointer(16)}var i,s}function F(e,t){try{return e.apply(this,t)}catch(r){var n=function(){try{return r instanceof Error?"".concat(r.message,"\n\nStack:\n").concat(r.stack):r.toString()}catch(e){return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",n),r}}function J(e){x===k.length&&k.push(k.length+1);var t=x;if("number"!==typeof(x=k[t]))throw new Error("corrupt heap");return k[t]=e,t}var W=new TextEncoder("utf-8"),D="function"===typeof W.encodeInto?function(e,t){return W.encodeInto(e,t)}:function(e,t){var n=W.encode(e);return t.set(n),{read:e.length,written:n.length}};function B(e,t,n){if("string"!==typeof e)throw new Error("expected a string argument");if(void 0===n){var r=W.encode(e),a=t(r.length);return A().subarray(a,a+r.length).set(r),I=r.length,a}for(var i=e.length,s=t(i),o=A(),l=0;l<i;l++){var u=e.charCodeAt(l);if(u>127)break;o[s+l]=u}if(l!==i){0!==l&&(e=e.slice(l)),s=n(s,i,i=l+3*e.length);var c=A().subarray(s+l,s+i),d=D(e,c);if(d.read!==e.length)throw new Error("failed to pass whole string");l+=d.written}return I=l,s}function U(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(y.a)(w.a.mark((function e(t,n){var r,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"===typeof Response&&t instanceof Response)){e.next=23;break}if("function"!==typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,n);case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return r=e.sent,e.next=20,WebAssembly.instantiate(r,n);case 20:return e.abrupt("return",e.sent);case 23:return e.next=25,WebAssembly.instantiate(t,n);case 25:if(!((a=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:a,module:t});case 30:return e.abrupt("return",a);case 31:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Z(e){return $.apply(this,arguments)}function $(){return($=Object(y.a)(w.a.mark((function e(t){var n,a,i,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n={}).wbg={},n.wbg.__wbg_error_4bb6c2a97407129a=function(){return F((function(e,t){try{console.error(N(e,t))}finally{r.__wbindgen_free(e,t)}}),arguments)},n.wbg.__wbg_new_59cb74e423758ede=function(){return F((function(){return J(new Error)}),arguments)},n.wbg.__wbg_stack_558ba5917b466edd=function(){return F((function(e,t){var n=B(j(t).stack,r.__wbindgen_malloc,r.__wbindgen_realloc),a=I;E()[e/4+1]=a,E()[e/4+0]=n}),arguments)},n.wbg.__wbindgen_object_drop_ref=function(e){S(e)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(N(e,t))},("string"===typeof t||"function"===typeof Request&&t instanceof Request||"function"===typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=U,e.next=12,t;case 12:return e.t1=e.sent,e.t2=n,e.next=16,(0,e.t0)(e.t1,e.t2);case 16:return a=e.sent,i=a.instance,s=a.module,r=i.exports,Z.__wbindgen_wasm_module=s,e.abrupt("return",r);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=Z,G=n(0),H=!1;q("/make-a-microprocessor/libsnpspice_bg.wasm").then((function(){H=!0,r.init_panic_hook()}));function V(e){var t=window.Sk;if(void 0===t.builtinFiles||void 0===t.builtinFiles.files[e])throw"File not found: '"+e+"'";return t.builtinFiles.files[e]}n(35).addDefineSimpleMode(b.a),b.a.defineSimpleMode("complang",{start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/(?:pfet|nfet|probe|wire|button|signal)\b/,token:"keyword"},{regex:/(?:vdd|gnd)\b/,token:"builtin"},{regex:/[01]+[.][.][.]/i,token:"number"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/`.*`/,token:"units"},{regex:/\/\/.*/,token:"comment"},{regex:/[-+\/*=<>!~]+/,token:"operator"},{regex:/\$[a-zA-Z_][a-zA-Z0-9_']*/,token:"compilevar"},{regex:/[a-zA-Z_][a-zA-Z0-9_']*/,token:"neutral"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"],lineComment:"//"}});var K=function(){function e(){Object(p.a)(this,e),this.weights=new Map,this.parents=new Map}return Object(h.a)(e,[{key:"canonicalize",value:function(e){this.weights.has(e)||(this.weights.set(e,1),this.parents.set(e,e));for(var t=[e],n=this.parents.get(e);n!==t[t.length-1];)t.push(n),n=this.parents.get(n);for(var r=0,a=t;r<a.length;r++){var i=a[r];this.parents.set(i,n)}return n}},{key:"union",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(0!==n.length){var a,i=n.map((function(t){return e.canonicalize(t)})),s=0,o=null,l=0,u=Object(f.a)(i);try{for(u.s();!(a=u.n()).done;){var c=a.value,d=this.weights.get(c);s+=d,d>l&&(o=c,l=d)}}catch(m){u.e(m)}finally{u.f()}this.weights.set(o,s);var p,h=Object(f.a)(i);try{for(h.s();!(p=h.n()).done;){var g=p.value;g!==o&&this.parents.set(g,o)}}catch(m){h.e(m)}finally{h.f()}}}}]),e}();function Q(e,t){var n,r=30*(e.probes.length+1),a=[],i=0,s=Object(f.a)(e.probes);try{for(s.s();!(n=s.n()).done;){var o,l=n.value,u=[],c=[],d=0,p=-1,h=e.netTraces.get(l.net),g=Object(f.a)(h);try{for(g.s();!(o=g.n()).done;){var m=o.value,b=3+5*d,v=3,_=27;if(0===m||(1===m?v=_=27:2===m?v=_=3:3===m&&(p=b)),0===d?u.push("M ".concat(b," ").concat(_)):u.push("L ".concat(b," ").concat(_)),c.push("L ".concat(b," ").concat(v)),d++,p>=0)break}}catch(y){g.e(y)}finally{g.f()}c.reverse(),c.push("Z"),a.push(Object(G.jsxs)("g",{transform:"translate(140 ".concat(30*i,")"),children:[Object(G.jsx)("text",{x:-140,y:20,stroke:"white",fill:"white",children:l.label}),Object(G.jsx)("path",{d:[].concat(u,c).join(" "),stroke:"white",strokeWidth:3,fill:"rgba(255, 255, 255, 0.3)"}),-1!==p&&Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("path",{d:"M ".concat(p," 3 L ").concat(p+110," 3 L ").concat(p+110," 27 L ").concat(p," 27 Z"),stroke:"red",strokeWidth:3,fill:"rgba(255, 0, 0, 0.3)"}),Object(G.jsx)("text",{x:p+5,y:20,stroke:"red",fill:"red",children:"Shoot through!"})]})]},i)),i++}}catch(y){s.e(y)}finally{s.f()}var w=143+5*t.failureTime;return Object(G.jsxs)("svg",{style:{width:"100%",height:r},children:[a,!t.success&&Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("path",{d:"M ".concat(w," 0 L ").concat(w," ").concat(r-20),stroke:"red",strokeWidth:2,fill:"transparent"}),Object(G.jsx)("text",{textAnchor:"middle",x:w,y:r-5,stroke:"red",fill:"red",children:t.miniMessage})]})]})}function X(e,t){localStorage.setItem("level-"+e+"-meta",JSON.stringify(t.metadata)),localStorage.setItem("level-"+e+"-saved-code",t.code)}function ee(e,t){var n,r=Object(f.a)(t);try{for(r.s();!(n=r.n()).done;){var a,i=n.value,s=i.net,o=i.netName,l=i.reqs,u=e.netTraces.get(s),c=Object(f.a)(l);try{for(c.s();!(a=c.n()).done;){var p=Object(d.a)(a.value,2),h=p[0],g=p[1];if(u[h]!==g){var m={0:"undriven",1:"low",2:"high"},b=m[u[h]],v=m[g];return{success:!1,failureTime:h,message:"".concat(o," is ").concat(b,", but should have been ").concat(v,"."),miniMessage:"".concat(o," should be ").concat(v)}}}}catch(_){c.e(_)}finally{c.f()}}}catch(_){r.e(_)}finally{r.f()}return{success:!0,failureTime:0,message:"All tests passed!",miniMessage:""}}var te=[{internalName:"fets",name:"FETs",levelDesc:'Welcome to make-a-processor. In each level you must use FETs to construct a circuit that passes the test. The objective for the level will always be in this box.\n\nYou construct circuits by writing a "Python" program in the left pane that emits components. You can run your program by hitting ctrl+enter in the code pane. The program\'s output will appear in the bottom right pane, and the results of the circuit simulation will appear in the top right page.\n\nTo get a list of components, and to see how to emit them, open up the components pane.\n\nYour goal in this first level is to use two FETs to drive the `not_A` net to be high when `A` is low, and vice versa.',startingCode:'# Your Python code here.\n\n# The nets vdd and gnd are built in, and are always 1 and 0 respectively.\nprobe("Power", vdd)\nprobe("Ground", gnd)\n\nA, = get_level_inputs()\nnot_A, = get_level_outputs()\n\nprobe("A", A)\nprobe("\xacA", not_A)\n\n# Hint:\n# nfet(gate, drain, source)\n# pfet(gate, drain, source)\n',makeInputNets:function(e){return e.push({kind:"signal",net:"_net_A",pattern:Object(c.a)("01"),repeat:!0}),["_net_A"]},makeOutputNets:function(){return["_net_not_A"]},gradeResults:function(e){return ee(e,[{net:"_net_not_A",netName:"\xacA",reqs:[[7,2],[17,1],[27,2],[37,1]]}])}},{internalName:"highz",name:"High-Z Output",levelDesc:"A component's output is said to be high Z (high impedance) when it isn't driven by the component. In this level you must construct a gated inverter that takes a second `output_enable` signal. Your gated inverter must drive the output if and only if `output_enable` is high.\n\nSpecifically, your component's truth table must be:\n\n  A | OE | out\n  -------------\n  0 | 0  |  Z\n  1 | 0  |  Z\n  0 | 1  |  1\n  1 | 1  |  0\n",startingCode:'A, output_enable = get_level_inputs()\nnot_A, = get_level_outputs()\n\nprobe("Output enable", output_enable)\nprobe("A", A)\nprobe("\xacA", not_A)\n',makeInputNets:function(e){return e.push({kind:"signal",net:"_net_A",pattern:Object(c.a)("z01001010"),repeat:!1},{kind:"signal",net:"_net_output_enable",pattern:Object(c.a)("000011100"),repeat:!1}),["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_not_A"]},gradeResults:function(e){return ee(e,[{net:"_net_not_A",netName:"\xacA",reqs:[[7,0],[17,0],[27,0],[37,0],[47,2],[57,1],[67,2],[77,0]]}])}},{internalName:"logic_gates",name:"Logic Gates",levelDesc:"We will now create logic gates. Implement ",startingCode:"\ndef not_gate(x):\n    r = new_net()\n    ...\n    return r\n",makeInputNets:function(){return["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_notA"]},gradeResults:function(e){return{success:!1,failureTime:3,message:"bad",miniMessage:"?"}}},{internalName:"adder",name:"Adder",levelDesc:"This is the first level.\nTo open up the documentation press ",startingCode:"# Your code here.\n",makeInputNets:function(){return["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_notA"]},gradeResults:function(e){return{success:!1,failureTime:3,message:"bad",miniMessage:"?"}}},{internalName:"flipflops",name:"Flip-Flops",levelDesc:"This is the first level.\nTo open up the documentation press ",startingCode:"# Your code here.\n",makeInputNets:function(){return["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_notA"]},gradeResults:function(e){return{success:!1,failureTime:3,message:"bad",miniMessage:"?"}}},{internalName:"state_machine",name:"State Machines",levelDesc:"This is the first level.\nTo open up the documentation press ",startingCode:"# Your code here.\n",makeInputNets:function(){return["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_notA"]},gradeResults:function(e){return{success:!1,failureTime:3,message:"bad",miniMessage:"?"}}},{internalName:"sram",name:"SRAM",levelDesc:"This is the first level.\nTo open up the documentation press ",startingCode:"# Your code here.\n",makeInputNets:function(){return["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_notA"]},gradeResults:function(e){return{success:!1,failureTime:3,message:"bad",miniMessage:"?"}}},{internalName:"microprocessor",name:"Microprocessor",levelDesc:"This is the first level.\nTo open up the documentation press ",startingCode:"# Your code here.\n",makeInputNets:function(){return["_net_A","_net_output_enable"]},makeOutputNets:function(){return["_net_notA"]},gradeResults:function(e){return{success:!1,failureTime:3,message:"bad",miniMessage:"?"}}}],ne=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).levelStates=void 0,r.onCompile=function(e){var t=window.Sk;t.pre="output";var n=[],a=[],i=0;function s(){return(++i).toString()}t.builtins.vdd=t.ffi.remapToPy("vdd"),t.builtins.gnd=t.ffi.remapToPy("gnd"),t.builtins.new_net=function(e){return t.ffi.remapToJs(e)+s()},t.builtins.new_net.co_varnames=["name"],t.builtins.new_net.$defaults=["net"],t.builtins.new_net.co_numargs=1,t.builtins.nfet=function(e,n,r){if(void 0===e||void 0===n)throw"nfet must be called like nfet(gate, drain, source) or like nfet(gate, drain) with source implicitly being gnd";if(e=t.ffi.remapToJs(e),n=t.ffi.remapToJs(n),void 0===(r=t.ffi.remapToJs(r))&&(r="gnd"),"string"!==typeof e)throw"nfet(gate, drain, source) gate argument must be net";if("string"!==typeof n)throw"nfet(gate, drain, source) drain argument must be net";if("string"!==typeof r)throw"nfet(gate, drain, source) source argument must be net";a.push({kind:"fet",isPfet:!1,gate:e,drain:n,source:r})},t.builtins.nfet.co_varnames=["gate","drain","source"],t.builtins.nfet.$defaults=[void 0,void 0,void 0],t.builtins.nfet.co_numargs=3,t.builtins.pfet=function(e,n,r){if(void 0===e||void 0===n)throw"pfet must be called like pfet(gate, drain, source) or like pfet(gate, drain) with source implicitly being vdd";if(e=t.ffi.remapToJs(e),n=t.ffi.remapToJs(n),void 0===(r=t.ffi.remapToJs(r))&&(r="vdd"),"string"!==typeof e)throw"pfet(gate, drain, source) gate argument must be net";if("string"!==typeof n)throw"pfet(gate, drain, source) drain argument must be net";if("string"!==typeof r)throw"pfet(gate, drain, source) source argument must be net";a.push({kind:"fet",isPfet:!0,gate:e,drain:n,source:r})},t.builtins.pfet.co_varnames=["gate","drain","source"],t.builtins.pfet.$defaults=[void 0,void 0,void 0],t.builtins.pfet.co_numargs=3,t.builtins.probe=function(e,n){if(e=t.ffi.remapToJs(e),n=t.ffi.remapToJs(n),"string"!==typeof e)throw"probe(label, net) label argument must be string";if("string"!==typeof n)throw"probe(label, net) net argument must be string";a.push({kind:"probe",label:e,net:n})},t.builtins.probe.co_varnames=["label","net"],t.builtins.probe.co_numargs=2,t.builtins.pull_down_resistor=function(e){if("string"!==typeof(e=t.ffi.remapToJs(e)))throw"pull_down_resistor(net) net argument must be string";a.push({kind:"pull_resistor",direction:"down",net:e})},t.builtins.pull_down_resistor.co_varnames=["net"],t.builtins.pull_down_resistor.co_numargs=1,t.builtins.pull_up_resistor=function(e){if("string"!==typeof(e=t.ffi.remapToJs(e)))throw"pull_up_resistor(net) net argument must be string";a.push({kind:"pull_resistor",direction:"up",net:e})},t.builtins.pull_up_resistor.co_varnames=["net"],t.builtins.pull_up_resistor.co_numargs=1,t.builtins.wire_together=function(e,n){if(e=t.ffi.remapToJs(e),n=t.ffi.remapToJs(n),"string"!==typeof e)throw"wire_together(net1, net2) net1 argument must be string";if("string"!==typeof n)throw"wire_together(net1, net2) net2 argument must be string";a.push({kind:"wire",nets:[e,n]})},t.builtins.wire_together.co_varnames=["net1","net2"],t.builtins.wire_together.co_numargs=2,t.builtins.signal=function(e,n){var r=t.ffi.remapToJs(n)+s();if(void 0===e)throw'signal must take pattern, like: signal("01...")';var i=(e=t.ffi.remapToJs(e).toLowerCase()).endsWith("...");i&&(e=e.slice(0,-3));var o,l=Object(f.a)(e);try{for(l.s();!(o=l.n()).done;){var u=o.value;if("0"!==u&&"1"!==u&&"z"!==u)throw"The pattern must be made of 0s, 1s and zs, and may optionally end with ... to indicate that the pattern should repeat."}}catch(c){l.e(c)}finally{l.f()}return a.push({kind:"signal",net:r,pattern:e,repeat:i}),t.ffi.remapToPy(r)},t.builtins.signal.co_varnames=["desc","name"],t.builtins.signal.$defaults=[void 0,"signal"],t.builtins.signal.co_numargs=2,t.builtins.get_level_inputs=function(){var e=r.state.currentLevel.makeInputNets(a);return t.ffi.remapToPy(e)},t.builtins.get_level_inputs.co_varnames=[],t.builtins.get_level_inputs.co_numargs=0,t.builtins.get_level_outputs=function(){var e=r.state.currentLevel.makeOutputNets(a);return t.ffi.remapToPy(e)},t.builtins.get_level_outputs.co_varnames=[],t.builtins.get_level_outputs.co_numargs=0,t.configure({output:function(e){n.push(e.toString())},read:V}),t.misceval.asyncToPromise((function(){return t.importMainWithBody("<stdin>",!1,e,!0)})).then((function(e){r.setState({terminalOutput:"Success: components=".concat(a.length,"\n")+n.join("")}),r.simulate(a)}),(function(e){r.setState({terminalOutput:n.join("")+"\n"+e.toString()})}))},r.levelStates=new Map,r.loadLevelStatesFromLocalStorage(),r.state={page:"level-select",currentLevel:null,code:"",terminalOutput:"",simOutput:"",simResults:null,grading:null},window.onpopstate=function(e){r.setState({page:"level-select"})},r}return Object(h.a)(n,[{key:"loadLevelStatesFromLocalStorage",value:function(){this.levelStates=new Map;var e,t=Object(f.a)(te);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=JSON.parse(localStorage.getItem("level-"+n.internalName+"-meta")||'{"savedVersion": 1, "everBeaten": false, "everOpened": false}'),a=localStorage.getItem("level-"+n.internalName+"-saved-code")||n.startingCode;this.levelStates.set(n.internalName,{metadata:r,code:a})}}catch(i){t.e(i)}finally{t.f()}}},{key:"reportError",value:function(e,t){var n=this.state.code.split("\n")[e-1];this.setState({terminalOutput:"  ".concat(n,"\n\nError on line ").concat(e,": ").concat(t)})}},{key:"simulate",value:function(e){e=[].concat(Object(c.a)(e),[{kind:"signal",net:"vdd",pattern:["1"],repeat:!1},{kind:"signal",net:"gnd",pattern:["0"],repeat:!1}]);var t,n=new Set(["vdd","gnd"]),r=[],a=new K,i=Object(f.a)(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;switch(s.kind){case"fet":for(var o=0,l=[s.gate,s.drain,s.source];o<l.length;o++){var u=l[o];n.add(u)}break;case"wire":var d,p=Object(f.a)(s.nets);try{for(p.s();!(d=p.n()).done;){var h=d.value;n.add(h)}}catch($){p.e($)}finally{p.f()}a.union.apply(a,Object(c.a)(s.nets));break;case"probe":r.push(s),n.add(s.net);break;case"pull_resistor":case"button":case"signal":n.add(s.net)}}}catch($){i.e($)}finally{i.f()}if(H){var g,m=[],b=new Map,v=Object(f.a)(n);try{for(v.s();!(g=v.n()).done;){var _=g.value,w=a.canonicalize(_);b.has(w)||b.set(w,b.size),b.set(_,b.get(w))}}catch($){v.e($)}finally{v.f()}var y,k=Object(f.a)(e);try{for(k.s();!(y=k.n()).done;){var j=y.value;switch(j.kind){case"fet":m.push(1,+j.isPfet,b.get(j.gate),b.get(j.drain),b.get(j.source));break;case"signal":m.push.apply(m,[2,b.get(j.net),+j.repeat,j.pattern.length].concat(Object(c.a)(Object(c.a)(j.pattern).map((function(e){return{0:0,1:1,z:2}[e]})))));break;case"pull_resistor":m.push(3,{up:0,down:1}[j.direction],b.get(j.net));break;default:continue}m.push(123456789)}}catch($){k.e($)}finally{k.f()}for(var x=P(new Uint32Array(m),b.size,400,10),S=R(),O=[],T=!1,A=1/0,N=0;N<S.length;N+=2){var M,L=S[N],I=S[N+1],C=x.slice(L,L+I),z=0,E=Object(f.a)(C);try{for(E.s();!(M=E.n()).done;){3==M.value&&(T=!0,A=Math.min(A,z)),z++}}catch($){E.e($)}finally{E.f()}O.push(C)}var F,J=new Map,W=Object(f.a)(n);try{for(W.s();!(F=W.n()).done;){var D=F.value;J.set(D,O[b.get(D)])}}catch($){W.e($)}finally{W.f()}var B="Components: ".concat(e.length-2,"  Nets: ").concat(n.size),U={components:e.length,nets:Object(c.a)(n),netTraces:J,probes:r,shootThroughOccurred:T,earliestShootThrough:A},Y=T?{success:!1,failureTime:A,message:"Shoot through (shorting vdd to gnd) is never allowed.",miniMessage:"Shoot through occurs here"}:this.state.currentLevel.gradeResults(U);if(Y.success){var Z=this.levelStates.get(this.state.currentLevel.internalName);Z.metadata.everBeaten=!0,X(this.state.currentLevel.internalName,Z)}else B+="\n\nLEVEL FAILED: "+Y.message;this.setState({simOutput:B,simResults:U,grading:Y})}else this.setState({simOutput:"Wasm component not initialized."})}},{key:"switchToLevel",value:function(e){this.setState({page:"level",currentLevel:e,code:this.levelStates.get(e.internalName).code,terminalOutput:"(Hit ctrl + enter in the code window to rerun.)",simOutput:"",simResults:null});var t=this.levelStates.get(e.internalName);t.metadata.everOpened=!0,X(e.internalName,t),window.history.pushState({page:"level",currentLevel:e.internalName},"Make a Microprocessor")}},{key:"render",value:function(){var e=this;if("level-select"===this.state.page){var t=!1;return Object(G.jsxs)("div",{style:{width:"100%",height:"100vh",color:"white",fontFamily:"monospace",display:"flex",justifyContent:"center",textAlign:"center",fontSize:"150%"},children:[Object(G.jsxs)("div",{style:{marginTop:30},children:[Object(G.jsx)("span",{style:{fontSize:"200%"},children:"Make a Processor"}),Object(G.jsx)("br",{}),Object(G.jsx)("br",{}),"Select a level:",Object(G.jsx)("div",{style:{display:"flex",flexDirection:"column",marginTop:20},children:te.map((function(n,r){var a=e.levelStates.get(n.internalName),i=Object(G.jsxs)("div",{style:{fontSize:"150%",margin:10,padding:10,width:300,position:"relative"},className:t?"lockedButton":"hoverButton",onClick:t?function(){return null}:function(){return e.switchToLevel(n)},children:[t?"???":n.name,!t&&!a.metadata.everOpened&&Object(G.jsx)("div",{style:{position:"absolute",fontSize:"80%",color:"red",left:"92%",top:"0%",transform:"rotate(30deg)"},children:"New!"}),a.metadata.everBeaten&&Object(G.jsx)("div",{style:{position:"absolute",fontSize:"300%",color:"green",left:"100%",top:"50%",transform:"translate(-50%, -50%)"},children:"\u2713"})]},r);return a.metadata.everBeaten||(t=!0),i}))})]}),Object(G.jsx)("div",{style:{position:"absolute",left:10,bottom:10},children:"By Peter Schmidt-Nielsen (v0.1)"}),Object(G.jsx)("div",{style:{position:"absolute",right:10,bottom:10,padding:10},className:"hoverButton",onClick:function(){window.confirm("Are you sure you want to completely reset the game state, including throwing away all of your code?")&&(localStorage.clear(),e.loadLevelStatesFromLocalStorage(),e.forceUpdate())},children:"Reset Entire Game State"})]})}var n,r=parseInt(localStorage.getItem("split1")||"500"),a=parseInt(localStorage.getItem("split2")||"400");return Object(G.jsxs)("div",{style:{display:"flex"},children:[Object(G.jsxs)(v.a,{split:"vertical",minSize:300,defaultSize:r,onChange:function(e){return localStorage.setItem("split1",e.toString())},resizerStyle:{background:"black",width:"3px",cursor:"col-resize",height:"100%"},children:[Object(G.jsxs)("div",{style:{position:"relative"},children:[Object(G.jsx)(g.Controlled,{value:this.state.code,options:(n=this.onCompile,{mode:"python",theme:"material",lineNumbers:!0,indentUnit:4,lineWrapping:!0,extraKeys:{"Ctrl-Enter":function(t){n(e.state.code)},"Ctrl-S":function(t){var n=e.levelStates.get(e.state.currentLevel.internalName);n.code=e.state.code,X(e.state.currentLevel.internalName,n),e.forceUpdate()}}}),onBeforeChange:function(t,n,r){e.setState({code:r})}}),this.state.code!==this.levelStates.get(this.state.currentLevel.internalName).code&&Object(G.jsx)("div",{style:{position:"absolute",right:"5%",bottom:"5%",userSelect:"none",zIndex:5,color:"red",opacity:.5},children:"\u2b24 Unsaved"})]}),Object(G.jsx)("div",{children:Object(G.jsxs)(v.a,{split:"horizontal",minSize:30,defaultSize:a,onChange:function(e){return localStorage.setItem("split2",e.toString())},resizerStyle:{background:"black",height:"3px",cursor:"row-resize",width:"100%"},children:[Object(G.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"#333",color:"white",fontFamily:"monospace"},children:Object(G.jsx)("div",{style:{margin:10},children:null!==this.state.simResults&&Q(this.state.simResults,this.state.grading)})}),Object(G.jsxs)("div",{style:{backgroundColor:"#222",color:"white",fontFamily:"monospace",width:"100%",height:"100%",display:"flex"},children:[Object(G.jsxs)("div",{style:{margin:10,width:400},children:[Object(G.jsx)("b",{children:this.state.currentLevel.name}),Object(G.jsx)("p",{style:{whiteSpace:"pre-wrap"},children:this.state.currentLevel.levelDesc})]}),Object(G.jsx)("div",{style:{width:2,backgroundColor:"#555"}}),Object(G.jsxs)("div",{style:{margin:10,whiteSpace:"pre-wrap",color:"white"},children:[this.state.terminalOutput,Object(G.jsx)("span",{style:{color:"red"},children:"\n\n"+this.state.simOutput})]})]})]})})]}),Object(G.jsx)("div",{style:{width:100},children:"asdf"})]})}}]),n}(i.a.PureComponent),re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),r(e),a(e),i(e),s(e)}))};o.a.render(Object(G.jsx)(i.a.StrictMode,{children:Object(G.jsx)(ne,{})}),document.getElementById("root")),re()}},[[36,1,2]]]);
//# sourceMappingURL=main.2de7f80f.chunk.js.map