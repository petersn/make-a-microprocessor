{"version":3,"sources":["simple.js","wasm-build/libsnpspice.js","App.tsx","reportWebVitals.js","index.js"],"names":["addDefineSimpleMode","CodeMirror","ensureState","states","name","hasOwnProperty","Error","toRegex","val","caret","flags","RegExp","ignoreCase","source","String","Rule","data","next","push","this","regex","token","apply","replace","result","i","length","asToken","tokenFunction","config","stream","state","pending","pend","shift","pos","text","local","end","match","tok","endToken","localState","m","mode","endScan","exec","current","start","index","curState","rule","matches","sol","stack","pop","enterLocalMode","indent","indentation","indentUnit","dedent","j","backUp","join","cmp","a","b","props","prop","spec","pers","persistent","p","persistentStates","getMode","lState","startState","forceEnd","indentFunction","meta","textAfter","line","dontIndentStates","arr","indexOf","Pass","rules","scan","dedentIfLineStart","slice","defineSimpleMode","defineMode","simpleMode","states_","hasIndentation","list","orig","copyState","s","innerMode","wasm","heap","Array","fill","undefined","getObject","idx","heap_next","takeObject","ret","dropObject","cachedTextDecoder","TextDecoder","ignoreBOM","fatal","decode","cachegetUint8Memory0","getUint8Memory0","buffer","memory","Uint8Array","getStringFromWasm0","ptr","len","subarray","cachegetUint32Memory0","getUint32Memory0","Uint32Array","WASM_VECTOR_LEN","_assertNum","n","cachegetInt32Memory0","getInt32Memory0","Int32Array","perform_simulation","description","net_count","duration","clock_divider","retptr","__wbindgen_add_to_stack_pointer","ptr0","arg","malloc","set","passArray32ToWasm0","__wbindgen_malloc","len0","r0","r1","v1","__wbindgen_free","get_indices","v0","logError","f","args","e","error","message","toString","_","console","addHeapObject","obj","cachedTextEncoder","TextEncoder","encodeString","encodeInto","view","buf","encode","read","written","passStringToWasm0","realloc","mem","offset","code","charCodeAt","load","module","imports","Response","WebAssembly","instantiateStreaming","headers","get","warn","arrayBuffer","bytes","instantiate","instance","Instance","init","input","wbg","__wbg_error_4bb6c2a97407129a","arg0","arg1","arguments","__wbg_new_59cb74e423758ede","__wbg_stack_558ba5917b466edd","__wbindgen_realloc","__wbindgen_object_drop_ref","__wbindgen_throw","Request","URL","fetch","exports","__wbindgen_wasm_module","wasmInitialized","process","then","init_panic_hook","builtinRead","x","Sk","window","builtinFiles","require","RawCodeMirror","comment","lineComment","UnionFind","weights","Map","parents","k","has","path","root","node","keys","roots","map","canonicalize","totalWeight","heaviest","heaviestWeight","weight","renderTraces","simResults","height","probes","svgContents","probeIndex","probe","forwardPass","backwardPass","shootThroughStart","trace","netTraces","net","traceVal","yMin","yMax","reverse","transform","y","stroke","label","d","strokeWidth","width","style","App","onCompile","pre","results","components","nextId","getId","builtins","vdd","ffi","remapToPy","gnd","new_net","remapToJs","co_varnames","$defaults","co_numargs","nfet","gate","drain","kind","isPfet","pfet","pull_down_resistor","direction","pull_up_resistor","wire_together","nets","button","signal","pattern","repeat","toLowerCase","endsWith","c","configure","output","misceval","asyncToPromise","importMainWithBody","mod","setState","terminalOutput","simulate","err","localStorage","getItem","simOutput","simResult","lineNum","lineOfCode","split","Set","netCanonicalizer","component","add","union","descArray","netIndices","canonicalizedNet","size","traceValues","traceIndices","traces","shootThroughOccurred","lines","comp","reportError","vertSplitDefault","parseInt","horizSplitDefault","display","minSize","defaultSize","onChange","setItem","resizerStyle","background","cursor","value","options","theme","lineNumbers","lineWrapping","extraKeys","cm","onBeforeChange","editor","backgroundColor","color","fontFamily","margin","whiteSpace","padding","React","PureComponent","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.58ff3378.chunk.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n// Hacked briefly by Peter Schmidt-Nielsen to make it easily requireable.\n\nexport function addDefineSimpleMode(CodeMirror) {\n    \"use strict\";\n  \n    CodeMirror.defineSimpleMode = function(name, states) {\n      CodeMirror.defineMode(name, function(config) {\n        return CodeMirror.simpleMode(config, states);\n      });\n    };\n  \n    CodeMirror.simpleMode = function(config, states) {\n      ensureState(states, \"start\");\n      var states_ = {}, meta = states.meta || {}, hasIndentation = false;\n      for (var state in states) if (state != meta && states.hasOwnProperty(state)) {\n        var list = states_[state] = [], orig = states[state];\n        for (var i = 0; i < orig.length; i++) {\n          var data = orig[i];\n          list.push(new Rule(data, states));\n          if (data.indent || data.dedent) hasIndentation = true;\n        }\n      }\n      var mode = {\n        startState: function() {\n          return {state: \"start\", pending: null,\n                  local: null, localState: null,\n                  indent: hasIndentation ? [] : null};\n        },\n        copyState: function(state) {\n          var s = {state: state.state, pending: state.pending,\n                   local: state.local, localState: null,\n                   indent: state.indent && state.indent.slice(0)};\n          if (state.localState)\n            s.localState = CodeMirror.copyState(state.local.mode, state.localState);\n          if (state.stack)\n            s.stack = state.stack.slice(0);\n          for (var pers = state.persistentStates; pers; pers = pers.next)\n            s.persistentStates = {mode: pers.mode,\n                                  spec: pers.spec,\n                                  state: pers.state == state.localState ? s.localState : CodeMirror.copyState(pers.mode, pers.state),\n                                  next: s.persistentStates};\n          return s;\n        },\n        token: tokenFunction(states_, config),\n        innerMode: function(state) { return state.local && {mode: state.local.mode, state: state.localState}; },\n        indent: indentFunction(states_, meta)\n      };\n      if (meta) for (var prop in meta) if (meta.hasOwnProperty(prop))\n        mode[prop] = meta[prop];\n      return mode;\n    };\n  \n    function ensureState(states, name) {\n      if (!states.hasOwnProperty(name))\n        throw new Error(\"Undefined state \" + name + \" in simple mode\");\n    }\n  \n    function toRegex(val, caret) {\n      if (!val) return /(?:)/;\n      var flags = \"\";\n      if (val instanceof RegExp) {\n        if (val.ignoreCase) flags = \"i\";\n        val = val.source;\n      } else {\n        val = String(val);\n      }\n      return new RegExp((caret === false ? \"\" : \"^\") + \"(?:\" + val + \")\", flags);\n    }\n  \n    function asToken(val) {\n      if (!val) return null;\n      if (val.apply) return val\n      if (typeof val == \"string\") return val.replace(/\\./g, \" \");\n      var result = [];\n      for (var i = 0; i < val.length; i++)\n        result.push(val[i] && val[i].replace(/\\./g, \" \"));\n      return result;\n    }\n  \n    function Rule(data, states) {\n      if (data.next || data.push) ensureState(states, data.next || data.push);\n      this.regex = toRegex(data.regex);\n      this.token = asToken(data.token);\n      this.data = data;\n    }\n  \n    function tokenFunction(states, config) {\n      return function(stream, state) {\n        if (state.pending) {\n          var pend = state.pending.shift();\n          if (state.pending.length == 0) state.pending = null;\n          stream.pos += pend.text.length;\n          return pend.token;\n        }\n  \n        if (state.local) {\n          if (state.local.end && stream.match(state.local.end)) {\n            var tok = state.local.endToken || null;\n            state.local = state.localState = null;\n            return tok;\n          } else {\n            var tok = state.local.mode.token(stream, state.localState), m;\n            if (state.local.endScan && (m = state.local.endScan.exec(stream.current())))\n              stream.pos = stream.start + m.index;\n            return tok;\n          }\n        }\n  \n        var curState = states[state.state];\n        for (var i = 0; i < curState.length; i++) {\n          var rule = curState[i];\n          var matches = (!rule.data.sol || stream.sol()) && stream.match(rule.regex);\n          if (matches) {\n            if (rule.data.next) {\n              state.state = rule.data.next;\n            } else if (rule.data.push) {\n              (state.stack || (state.stack = [])).push(state.state);\n              state.state = rule.data.push;\n            } else if (rule.data.pop && state.stack && state.stack.length) {\n              state.state = state.stack.pop();\n            }\n  \n            if (rule.data.mode)\n              enterLocalMode(config, state, rule.data.mode, rule.token);\n            if (rule.data.indent)\n              state.indent.push(stream.indentation() + config.indentUnit);\n            if (rule.data.dedent)\n              state.indent.pop();\n            var token = rule.token\n            if (token && token.apply) token = token(matches)\n            if (matches.length > 2 && rule.token && typeof rule.token != \"string\") {\n              state.pending = [];\n              for (var j = 2; j < matches.length; j++)\n                if (matches[j])\n                  state.pending.push({text: matches[j], token: rule.token[j - 1]});\n              stream.backUp(matches[0].length - (matches[1] ? matches[1].length : 0));\n              return token[0];\n            } else if (token && token.join) {\n              return token[0];\n            } else {\n              return token;\n            }\n          }\n        }\n        stream.next();\n        return null;\n      };\n    }\n  \n    function cmp(a, b) {\n      if (a === b) return true;\n      if (!a || typeof a != \"object\" || !b || typeof b != \"object\") return false;\n      var props = 0;\n      for (var prop in a) if (a.hasOwnProperty(prop)) {\n        if (!b.hasOwnProperty(prop) || !cmp(a[prop], b[prop])) return false;\n        props++;\n      }\n      for (var prop in b) if (b.hasOwnProperty(prop)) props--;\n      return props == 0;\n    }\n  \n    function enterLocalMode(config, state, spec, token) {\n      var pers;\n      if (spec.persistent) for (var p = state.persistentStates; p && !pers; p = p.next)\n        if (spec.spec ? cmp(spec.spec, p.spec) : spec.mode == p.mode) pers = p;\n      var mode = pers ? pers.mode : spec.mode || CodeMirror.getMode(config, spec.spec);\n      var lState = pers ? pers.state : CodeMirror.startState(mode);\n      if (spec.persistent && !pers)\n        state.persistentStates = {mode: mode, spec: spec.spec, state: lState, next: state.persistentStates};\n  \n      state.localState = lState;\n      state.local = {mode: mode,\n                     end: spec.end && toRegex(spec.end),\n                     endScan: spec.end && spec.forceEnd !== false && toRegex(spec.end, false),\n                     endToken: token && token.join ? token[token.length - 1] : token};\n    }\n  \n    function indexOf(val, arr) {\n      for (var i = 0; i < arr.length; i++) if (arr[i] === val) return true;\n    }\n  \n    function indentFunction(states, meta) {\n      return function(state, textAfter, line) {\n        if (state.local && state.local.mode.indent)\n          return state.local.mode.indent(state.localState, textAfter, line);\n        if (state.indent == null || state.local || meta.dontIndentStates && indexOf(state.state, meta.dontIndentStates) > -1)\n          return CodeMirror.Pass;\n  \n        var pos = state.indent.length - 1, rules = states[state.state];\n        scan: for (;;) {\n          for (var i = 0; i < rules.length; i++) {\n            var rule = rules[i];\n            if (rule.data.dedent && rule.data.dedentIfLineStart !== false) {\n              var m = rule.regex.exec(textAfter);\n              if (m && m[0]) {\n                pos--;\n                if (rule.next || rule.push) rules = states[rule.next || rule.push];\n                textAfter = textAfter.slice(m[0].length);\n                continue scan;\n              }\n            }\n          }\n          break;\n        }\n        return pos < 0 ? 0 : state.indent[pos];\n      };\n    }\n  };\n  \n","\nlet wasm;\n\nconst heap = new Array(32).fill(undefined);\n\nheap.push(undefined, null, true, false);\n\nfunction getObject(idx) { return heap[idx]; }\n\nlet heap_next = heap.length;\n\nfunction dropObject(idx) {\n    if (idx < 36) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\n\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\n\nlet cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nlet cachegetUint8Memory0 = null;\nfunction getUint8Memory0() {\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory0().subarray(ptr, ptr + len));\n}\n/**\n*/\nexport function init_panic_hook() {\n    wasm.init_panic_hook();\n}\n\nlet cachegetUint32Memory0 = null;\nfunction getUint32Memory0() {\n    if (cachegetUint32Memory0 === null || cachegetUint32Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint32Memory0 = new Uint32Array(wasm.memory.buffer);\n    }\n    return cachegetUint32Memory0;\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nfunction passArray32ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 4);\n    getUint32Memory0().set(arg, ptr / 4);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nfunction _assertNum(n) {\n    if (typeof(n) !== 'number') throw new Error('expected a number argument');\n}\n\nlet cachegetInt32Memory0 = null;\nfunction getInt32Memory0() {\n    if (cachegetInt32Memory0 === null || cachegetInt32Memory0.buffer !== wasm.memory.buffer) {\n        cachegetInt32Memory0 = new Int32Array(wasm.memory.buffer);\n    }\n    return cachegetInt32Memory0;\n}\n\nfunction getArrayU8FromWasm0(ptr, len) {\n    return getUint8Memory0().subarray(ptr / 1, ptr / 1 + len);\n}\n/**\n* @param {Uint32Array} description\n* @param {number} net_count\n* @param {number} duration\n* @param {number} clock_divider\n* @returns {Uint8Array}\n*/\nexport function perform_simulation(description, net_count, duration, clock_divider) {\n    try {\n        const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);\n        var ptr0 = passArray32ToWasm0(description, wasm.__wbindgen_malloc);\n        var len0 = WASM_VECTOR_LEN;\n        _assertNum(net_count);\n        _assertNum(duration);\n        _assertNum(clock_divider);\n        wasm.perform_simulation(retptr, ptr0, len0, net_count, duration, clock_divider);\n        var r0 = getInt32Memory0()[retptr / 4 + 0];\n        var r1 = getInt32Memory0()[retptr / 4 + 1];\n        var v1 = getArrayU8FromWasm0(r0, r1).slice();\n        wasm.__wbindgen_free(r0, r1 * 1);\n        return v1;\n    } finally {\n        wasm.__wbindgen_add_to_stack_pointer(16);\n    }\n}\n\nfunction getArrayU32FromWasm0(ptr, len) {\n    return getUint32Memory0().subarray(ptr / 4, ptr / 4 + len);\n}\n/**\n* @returns {Uint32Array}\n*/\nexport function get_indices() {\n    try {\n        const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);\n        wasm.get_indices(retptr);\n        var r0 = getInt32Memory0()[retptr / 4 + 0];\n        var r1 = getInt32Memory0()[retptr / 4 + 1];\n        var v0 = getArrayU32FromWasm0(r0, r1).slice();\n        wasm.__wbindgen_free(r0, r1 * 4);\n        return v0;\n    } finally {\n        wasm.__wbindgen_add_to_stack_pointer(16);\n    }\n}\n\nfunction logError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        let error = (function () {\n            try {\n                return e instanceof Error ? `${e.message}\\n\\nStack:\\n${e.stack}` : e.toString();\n            } catch(_) {\n                return \"<failed to stringify thrown value>\";\n            }\n        }());\n        console.error(\"wasm-bindgen: imported JS function that was not marked as `catch` threw an error:\", error);\n        throw e;\n    }\n}\n\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n\n    if (typeof(heap_next) !== 'number') throw new Error('corrupt heap');\n\n    heap[idx] = obj;\n    return idx;\n}\n\nlet cachedTextEncoder = new TextEncoder('utf-8');\n\nconst encodeString = (typeof cachedTextEncoder.encodeInto === 'function'\n    ? function (arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n}\n    : function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n});\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (typeof(arg) !== 'string') throw new Error('expected a string argument');\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length);\n        getUint8Memory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len);\n\n    const mem = getUint8Memory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3);\n        const view = getUint8Memory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n        if (ret.read !== arg.length) throw new Error('failed to pass whole string');\n        offset += ret.written;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nasync function load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nasync function init(input) {\n    if (typeof input === 'undefined') {\n// Line deleted.\n    }\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_error_4bb6c2a97407129a = function() { return logError(function (arg0, arg1) {\n        try {\n            console.error(getStringFromWasm0(arg0, arg1));\n        } finally {\n            wasm.__wbindgen_free(arg0, arg1);\n        }\n    }, arguments) };\n    imports.wbg.__wbg_new_59cb74e423758ede = function() { return logError(function () {\n        var ret = new Error();\n        return addHeapObject(ret);\n    }, arguments) };\n    imports.wbg.__wbg_stack_558ba5917b466edd = function() { return logError(function (arg0, arg1) {\n        var ret = getObject(arg1).stack;\n        var ptr0 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len0 = WASM_VECTOR_LEN;\n        getInt32Memory0()[arg0 / 4 + 1] = len0;\n        getInt32Memory0()[arg0 / 4 + 0] = ptr0;\n    }, arguments) };\n    imports.wbg.__wbindgen_object_drop_ref = function(arg0) {\n        takeObject(arg0);\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    if (typeof input === 'string' || (typeof Request === 'function' && input instanceof Request) || (typeof URL === 'function' && input instanceof URL)) {\n        input = fetch(input);\n    }\n\n\n\n    const { instance, module } = await load(await input, imports);\n\n    wasm = instance.exports;\n    init.__wbindgen_wasm_module = module;\n\n    return wasm;\n}\n\nexport default init;\n\n","import React from 'react';\nimport './App.css';\nimport { Controlled as ControlledCodeMirror } from 'react-codemirror2';\nimport 'codemirror/lib/codemirror.css';\nimport 'codemirror/theme/material.css';\nimport 'codemirror/mode/python/python';\nimport RawCodeMirror from 'codemirror';\nimport SplitPane from 'react-split-pane';\nimport Collapsible from 'react-collapsible';\n\nimport init, {\n  get_indices,\n  perform_simulation,\n  init_panic_hook,\n} from './wasm-build/libsnpspice.js';\n\nlet wasmInitialized = false;\nlet wasm = init(process.env.PUBLIC_URL + \"/libsnpspice_bg.wasm\")\n  .then(() => {\n    wasmInitialized = true;\n    init_panic_hook();\n  });\n\ninterface ECompFet {\n  kind: 'fet';\n  isPfet: boolean;\n  gate: string;\n  drain: string;\n  source: string;\n}\n\ninterface EPullResistor {\n  kind: 'pull_resistor';\n  direction: 'up' | 'down';\n  net: string;\n}\n\ninterface EProbe {\n  kind: 'probe';\n  label: string;\n  net: string;\n}\n\ninterface EWire {\n  kind: 'wire';\n  nets: string[];\n}\n\ninterface EButton {\n  kind: 'button';\n  net: string;\n}\n\ninterface ESignal {\n  kind: 'signal';\n  net: string;\n  pattern: ('0' | '1' | 'z')[];\n  repeat: boolean;\n}\n\ntype EComponent = (\n  ECompFet |\n  EPullResistor |\n  EProbe |\n  EWire |\n  EButton |\n  ESignal\n);\n\n//import createPlotlyComponent from \"react-plotly.js/factory\";\n\n//// Importing plotly is a little bit of a nightmare.\n//// If we just try to directly `import Plot from \"react-plotly.js\"` then webpack runs out of memory trying to build.\n//const Plotly = require('plotly.js/lib/core');\n//Plotly.register([\n//    require('plotly.js/lib/heatmap'),\n//]);\n//const Plot = createPlotlyComponent(Plotly);\n\nfunction builtinRead(x: string) {\n  const Sk = (window as any).Sk;\n  if (Sk.builtinFiles === undefined || Sk.builtinFiles[\"files\"][x] === undefined)\n    throw \"File not found: '\" + x + \"'\";\n  return Sk.builtinFiles[\"files\"][x];\n}\n\nconst pyPrefix = `\nvdd = \"vdd\";\ngnd = \"gnd\";\n\ndef nfet(gate, drain, source):\n  pass\n\ndef pfet(gate, drain, source):\n  pass\n`;\n\nconst startingCode = `# This is \"Python\" (Skulpt).\n# To build up your solution to the puzzle simply call the functions documented below to emit circuit components.\n#\n# You have the following functions:\n#\n#   new_net(name_prefix: Optional[str] = 'net') -> Net\n#     Creates a new unique net, with an optional name prefix.\n#\n#   nfet(gate: Net, drain: Net, source: Optional[Net])\n#     Emits an n-channel FET into the circuit (pulls drain down to source when gate is high).\n#     If the source is omitted it defaults to gnd.\n#     It is a CMOS design rule violation if source can somehow be pulled high.\n#\n#   pfet(gate: Net, drain: Net, source: Optional[Net])\n#     Emits a p-channel FET into the circuit (pulls drain up to source when gate is low).\n#     If the source is omitted it defaults to vdd.\n#     It is a CMOS design rule violation if source can somehow be pulled low.\n#\n#   probe(label: str, net: Net)\n#     Marks the net to be plotted. Has no electrical effect.\n#\n#   wire_together(nets: List[Net])\n#     Electrically connects all of the listed nets.\n#\n#   button(label: Optional[str]) -> Net\n#     Emits a one-terminal push button, and return the button's output net.\n#     When the button is pushed the net is pulled high, and when released pulled low.\n#\n#   signal(pattern: str) -> Net\n#     Emits a signal generator component, and return the generator's output net.\n#     The pattern must be made of 0s, 1s, and zs, and may optionally end with ... to indicate that the pattern should repeat.\n#     If the \n#     The value z indicates that the signal shouldn't drive the output (high Z).\n#     Examples:\n#       clock = signal('01...') # Creates a clock signal that toggles every time step.\n#       output = signal('zzz1z') # Waits three time steps, then drives high, then stops driving forever.\n#\n# The net gnd is always low, and the net vdd is always high.\n\n# Create an inverter.\noutput = new_net()\nclock = signal('01...')\nnfet(clock, output, gnd)\npfet(clock, output, vdd)\nprobe('clock', clock)\nprobe('inverter output', output)\n`\n\nrequire(\"./simple.js\").addDefineSimpleMode(RawCodeMirror);\n\n(RawCodeMirror as any).defineSimpleMode(\"complang\", {\n  start: [\n    // Match strings.\n    { regex: /\"(?:[^\\\\]|\\\\.)*?(?:\"|$)/, token: \"string\" },\n    // Match keywords.\n    { regex: /(?:pfet|nfet|probe|wire|button|signal)\\b/, token: \"keyword\" },\n    // Match initialization and driving.\n    //{regex: /~|<-/, token: \"drive\"},\n    // Match built-ins.\n    { regex: /(?:vdd|gnd)\\b/, token: \"builtin\" },\n    /*\n    {regex: /(?:Slider|Selector|Checkbox|Uniform|Gaussian|Gamma|Beta|Frechet|PoissonProcess|WienerProcess|WienerDerivative|WienerDerivativeUnstable|D|Integrate|exp|log|sin|cos|sqrt|abs|floor|ceil|round|min|max|select|len|str|addDeriv|subDeriv|index_interpolating|print)\\b/, token: \"builtin\"},\n    {regex: /(?:globalTime|globalStepSize|e|pi|true|false|backend|tolerance|stepsize|maxplotpoints|integrator|simtime|minstep|maxstep|mcsamples|mctraces|mcenvelope|randomseed|processscale|mcpercentile|prefix|unitname|redrawperiod|crossoverprob|diffweight|populationsize|maxsteps|patience|patiencefactor|objectiveaggregation)\\b/, token: \"atom\"},\n    */\n    // Match embedded javascript.\n    //{regex: /javascript\\s{/, token: \"meta\", mode: {spec: \"javascript\", end: /}/}},\n    // Match numbers.\n    { regex: /[01]+[.][.][.]/i, token: \"number\" },\n    { regex: /0x[a-f\\d]+|[-+]?(?:\\.\\d+|\\d+\\.?\\d*)(?:e[-+]?\\d+)?/i, token: \"number\" },\n    // Match units.\n    { regex: /`.*`/, token: \"units\" },\n    // Handle comments.\n    { regex: /\\/\\/.*/, token: \"comment\" },\n    //{regex: /\\/\\*/, token: \"comment\", next: \"comment\"},\n    // Match operators.\n    { regex: /[-+\\/*=<>!~]+/, token: \"operator\" },\n    // Match compile-time variables.\n    { regex: /\\$[a-zA-Z_][a-zA-Z0-9_']*/, token: \"compilevar\" },\n    // Match variables.\n    { regex: /[a-zA-Z_][a-zA-Z0-9_']*/, token: \"neutral\" },\n    // Indent and dedent on list/dict literals.\n    { regex: /[\\{\\[\\(]/, indent: true },\n    { regex: /[\\}\\]\\)]/, dedent: true },\n  ],\n  comment: [\n    { regex: /.*?\\*\\//, token: \"comment\", next: \"start\" },\n    { regex: /.*/, token: \"comment\" }\n  ],\n  meta: {\n    dontIndentStates: [\"comment\"],\n    lineComment: \"//\",\n  },\n});\n\nclass UnionFind<Key> {\n  weights = new Map<Key, number>();\n  parents = new Map<Key, Key>();\n\n  canonicalize(k: Key): Key {\n    if (!this.weights.has(k)) {\n      this.weights.set(k, 1);\n      this.parents.set(k, k);\n    }\n\n    const path = [k];\n    let root = this.parents.get(k)!;\n    while (root !== path[path.length - 1]) {\n      path.push(root);\n      root = this.parents.get(root)!;\n    }\n\n    for (const node of path)\n      this.parents.set(node, root);\n    return root;\n  }\n\n  union(...keys: Key[]) {\n    if (keys.length === 0)\n      return;\n    const roots = keys.map((k) => this.canonicalize(k));\n    // Find the heaviest.\n    let totalWeight = 0;\n    let heaviest = null as unknown as Key;\n    let heaviestWeight = 0;\n    for (const root of roots) {\n      const weight = this.weights.get(root)!;\n      totalWeight += weight;\n      if (weight > heaviestWeight) {\n        heaviest = root;\n        heaviestWeight = weight;\n      }\n    }\n    // Reweight and reparent.\n    this.weights.set(heaviest!, totalWeight);\n    for (const root of roots) {\n      if (root !== heaviest) {\n        this.parents.set(root, heaviest);\n      }\n    }\n  }\n}\n\nfunction renderTraces(simResults: ISimResults) {\n  const width = 800;\n  const height = 30 * simResults.probes.length;\n\n  const svgContents = [];\n\n  let probeIndex = 0;\n\n  for (const probe of simResults.probes) {\n    const forwardPass: string[] = [];\n    const backwardPass: string[] = [];\n    const xStep = 5;\n    let i = 0;\n    let shootThroughStart = -1;\n    const trace = simResults.netTraces.get(probe.net)!;\n    for (const traceVal of trace) {\n      const x = 3 + i * xStep;\n      let yMin = 3;\n      let yMax = 27;\n      if (traceVal === 0) {\n      } else if (traceVal === 1) {\n        yMin = yMax = 27;\n      } else if (traceVal === 2) {\n        yMin = yMax = 3;\n      } else if (traceVal === 3) {\n        shootThroughStart = x;\n      }\n      if (i === 0)\n        forwardPass.push(`M ${x} ${yMax}`);\n      else\n        forwardPass.push(`L ${x} ${yMax}`);\n      backwardPass.push(`L ${x} ${yMin}`);\n      i++;\n      if (shootThroughStart >= 0)\n        break;\n    }\n    backwardPass.reverse();\n    backwardPass.push('Z');\n\n    svgContents.push(\n      <g key={probeIndex} transform={`translate(140 ${probeIndex * 30})`}>\n        <text x={-140} y={20} stroke='white' fill='white'>{probe.label}</text>\n        <path\n          d={[...forwardPass, ...backwardPass].join(' ')}\n          stroke='white'\n          strokeWidth={3}\n          fill='rgba(255, 255, 255, 0.3)'\n        />\n        {\n          shootThroughStart !== -1 &&\n          <path\n            d={`M ${shootThroughStart} 3 L ${width - 3} 3 L ${width - 3} 27 L ${shootThroughStart} 27 Z`}\n            stroke='red'\n            strokeWidth={3}\n            fill='rgba(255, 0, 0, 0.3)'\n          />\n        }\n      </g>\n    );\n    probeIndex++;\n  }\n\n  return <svg style={{\n    width, height,\n  }}>\n    {svgContents}\n  </svg>;\n}\n\ninterface ISimResults {\n  components: number;\n  nets: string[];\n  netTraces: Map<string, Uint8Array>;\n  probes: EProbe[];\n  shootThroughOccurred: boolean;\n}\n\ninterface IAppState {\n  code: string;\n  terminalOutput: string;\n  simOutput: string;\n  components: EComponent[];\n  simResult: null | ISimResults;\n}\n\ninterface ILevel {\n  \n}\n\nclass App extends React.PureComponent<{}, IAppState> {\n  constructor(props: {}) {\n    super(props);\n    this.state = {\n      code: localStorage.getItem('code') || startingCode,\n      terminalOutput: '(Hit ctrl + enter in the code window to rerun.)',\n      simOutput: '',\n      components: [],\n      simResult: null,\n    };\n  }\n\n  reportError(lineNum: number, message: string) {\n    const lineOfCode = this.state.code.split('\\n')[lineNum - 1];\n    this.setState({\n      terminalOutput: `  ${lineOfCode}\\n\\nError on line ${lineNum}: ${message}`,\n    });\n  }\n\n  simulate(components: EComponent[]) {\n    // Insert components for power and ground.\n    components = [\n      ...components,\n      {kind: 'signal', net: 'vdd', pattern: ['1'], repeat: false},\n      {kind: 'signal', net: 'gnd', pattern: ['0'], repeat: false},\n    ];\n    // Find all nets.\n    const nets = new Set<string>(['vdd', 'gnd']);\n    const probes: EProbe[] = [];\n    const netCanonicalizer = new UnionFind<string>();\n    for (const component of components) {\n      switch (component.kind) {\n        case 'fet':\n          for (const net of [component.gate, component.drain, component.source])\n            nets.add(net);\n          break;\n        case 'wire':\n          for (const net of component.nets)\n            nets.add(net);\n          netCanonicalizer.union(...component.nets);\n          break;\n        case 'probe':\n          probes.push(component);\n          nets.add(component.net);\n          break;\n        case 'pull_resistor':\n        case 'button':\n        case 'signal':\n          nets.add(component.net);\n          break;\n      }\n    }\n\n    // TODO: Possibly run DRCs here, like checking that it's valid CMOS.\n\n    if (!wasmInitialized) {\n      this.setState({ simOutput: 'Wasm component not initialized.' });\n      return;\n    }\n\n    // Serialize the results.\n    const descArray: number[] = [];\n    const netIndices = new Map<string, number>();\n    for (const net of nets) {\n      const canonicalizedNet = netCanonicalizer.canonicalize(net);\n      if (!netIndices.has(canonicalizedNet)) {\n        netIndices.set(canonicalizedNet, netIndices.size);\n      }\n      netIndices.set(net, netIndices.get(canonicalizedNet)!);\n    }\n    for (const component of components) {\n      switch (component.kind) {\n        case 'fet':\n          descArray.push(\n            1,\n            +component.isPfet,\n            netIndices.get(component.gate)!,\n            netIndices.get(component.drain)!,\n            netIndices.get(component.source)!,\n          );\n          break;\n        case 'pull_resistor':\n          descArray.push(\n            2,\n            {'up': 0, 'down': 1}[component.direction],\n            netIndices.get(component.net)!,\n          );\n          break;\n        case 'signal':\n          descArray.push(\n            3,\n            netIndices.get(component.net)!,\n            +component.repeat,\n            component.pattern.length,\n            ...[...component.pattern].map((c) => ({'0': 0, '1': 1, 'z': 2}[c])),\n          );\n          break;\n        default:\n          continue;\n      }\n      descArray.push(123456789);\n    }\n    const desc = new Uint32Array(descArray);\n    const traceValues = perform_simulation(desc, netIndices.size, 100, 10);\n    const traceIndices = get_indices();\n    const traces: Uint8Array[] = [];\n    let shootThroughOccurred = false;\n    for (let i = 0; i < traceIndices.length; i += 2) {\n      const start = traceIndices[i];\n      const len = traceIndices[i + 1];\n      const trace = traceValues.slice(start, start + len);\n      for (const v of trace)\n        if (v == 3)\n          shootThroughOccurred = true;\n      traces.push(trace);\n    }\n\n    const netTraces = new Map<string, Uint8Array>();\n    for (const net of nets)\n      netTraces.set(net, traces[netIndices.get(net)!]);\n\n    let simOutput = `Components: ${components.length - 2}  Nets: ${nets.size}`;\n    const simResult: ISimResults = {\n      components: components.length,\n      nets: [...nets],\n      netTraces,\n      probes,\n      shootThroughOccurred,\n    };\n    this.setState({ components, simOutput, simResult });\n  }\n\n  onCompile = (code: string) => {\n    const Sk = (window as any).Sk;\n    Sk.pre = \"output\";\n    var results: string[] = [];\n\n    const components: EComponent[] = [];\n\n    var nextId = 0;\n    function getId(): string {\n      nextId++;\n      return nextId.toString();\n    }\n\n    Sk.builtins.vdd = Sk.ffi.remapToPy('vdd');\n    Sk.builtins.gnd = Sk.ffi.remapToPy('gnd');\n\n    Sk.builtins.new_net = (name: any) => {\n      return Sk.ffi.remapToJs(name) + getId();\n    };\n    Sk.builtins.new_net.co_varnames = ['name'];\n    Sk.builtins.new_net.$defaults = ['net'];\n    Sk.builtins.new_net.co_numargs = 1;\n\n    Sk.builtins.nfet = (gate: any, drain: any, source: any) => {\n      if (gate === undefined || drain === undefined)\n        throw 'nfet must be called like nfet(gate, drain, source) or like nfet(gate, drain) with source implicitly being gnd';\n      gate = Sk.ffi.remapToJs(gate);\n      drain = Sk.ffi.remapToJs(drain);\n      source = Sk.ffi.remapToJs(source);\n      if (source === undefined)\n        source = 'gnd';\n      components.push({ kind: 'fet', isPfet: false, gate, drain, source });\n    };\n    Sk.builtins.nfet.co_varnames = ['gate', 'drain', 'source'];\n    Sk.builtins.nfet.$defaults = [undefined, undefined, undefined];\n    Sk.builtins.nfet.co_numargs = 3;\n\n    Sk.builtins.pfet = (gate: any, drain: any, source: any) => {\n      if (gate === undefined || drain === undefined)\n        throw 'pfet must be called like pfet(gate, drain, source) or like pfet(gate, drain) with source implicitly being vdd';\n      gate = Sk.ffi.remapToJs(gate);\n      drain = Sk.ffi.remapToJs(drain);\n      source = Sk.ffi.remapToJs(source);\n      if (source === undefined)\n        source = 'vdd';\n      components.push({ kind: 'fet', isPfet: true, gate, drain, source });\n    };\n    Sk.builtins.pfet.co_varnames = ['gate', 'drain', 'source'];\n    Sk.builtins.pfet.$defaults = [undefined, undefined, undefined];\n    Sk.builtins.pfet.co_numargs = 3;\n\n    Sk.builtins.probe = (label: string, net: any) => {\n      label = Sk.ffi.remapToJs(label);\n      net = Sk.ffi.remapToJs(net);\n      components.push({ kind: 'probe', label, net });\n    };\n    Sk.builtins.probe.co_varnames = ['label', 'net'];\n    Sk.builtins.probe.co_numargs = 2;\n\n    Sk.builtins.pull_down_resistor = (net: any) => {\n      net = Sk.ffi.remapToJs(net);\n      components.push({ kind: 'pull_resistor', direction: 'down', net });\n    };\n    Sk.builtins.pull_down_resistor.co_varnames = ['net'];\n    Sk.builtins.pull_down_resistor.co_numargs = 1;\n\n    Sk.builtins.pull_up_resistor = (net: any) => {\n      net = Sk.ffi.remapToJs(net);\n      components.push({ kind: 'pull_resistor', direction: 'up', net });\n    };\n    Sk.builtins.pull_up_resistor.co_varnames = ['net'];\n    Sk.builtins.pull_up_resistor.co_numargs = 1;\n\n    Sk.builtins.wire_together = (nets: any) => {\n      nets = Sk.ffi.remapToJs(nets);\n      components.push({ kind: 'wire', nets });\n    };\n    Sk.builtins.wire_together.co_varnames = ['nets'];\n    Sk.builtins.wire_together.co_numargs = 1;\n\n    Sk.builtins.button = () => {\n      const net = 'button' + getId();\n      components.push({ kind: 'button', net });\n      return Sk.ffi.remapToPy(net);\n    };\n    Sk.builtins.button.co_varnames = [];\n    Sk.builtins.button.co_numargs = 0;\n\n    Sk.builtins.signal = (pattern: any, name: any) => {\n      const net = Sk.ffi.remapToJs(name) + getId();\n      if (pattern === undefined)\n        throw 'signal must take pattern, like: signal(\"01...\")';\n      pattern = Sk.ffi.remapToJs(pattern).toLowerCase();\n      const repeat = pattern.endsWith('...');\n      if (repeat)\n        pattern = pattern.slice(0, -3);\n      for (const c of pattern)\n        if (c !== '0' && c !== '1' && c !== 'z')\n          throw 'The pattern must be made of 0s, 1s and zs, and may optionally end with ... to indicate that the pattern should repeat.';\n      components.push({ kind: 'signal', net, pattern, repeat });\n      return Sk.ffi.remapToPy(net);\n    };\n    Sk.builtins.signal.co_varnames = ['desc', 'name'];\n    Sk.builtins.signal.$defaults = [undefined, 'signal'];\n    Sk.builtins.signal.co_numargs = 2;\n\n    Sk.configure({\n      output: (obj: any) => {\n        results.push(obj.toString());\n        //console.log('Printing:', obj.toString());\n      },\n      read: builtinRead,\n    });\n    //(Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';\n    var myPromise = Sk.misceval.asyncToPromise(function () {\n      return Sk.importMainWithBody(\"<stdin>\", false, code, true);\n    });\n    myPromise.then(\n      (mod: any) => {\n        //console.log('success');\n        this.setState({ terminalOutput: `Success: components=${components.length}\\n` + results.join('') });\n        this.simulate(components);\n      },\n      (err: any) => {\n        this.setState({ terminalOutput: results.join('') + '\\n' + err.toString() });\n      },\n    );\n  }\n\n  oldOnCompile(code: string) {\n    const lines = code.split('\\n');\n    let lineNum = 0;\n    const components: any[] = [];\n    for (let line of lines) {\n      lineNum++;\n      line = line.split('//')[0];\n      if (line.length === 0)\n        continue;\n      const comp = line.split(/ +/);\n      if (comp[0] === 'nfet' || comp[0] === 'pfet') {\n        if (comp.length !== 4)\n          return this.reportError(lineNum, 'FET must take three arguments: nfet/pfet gate drain source');\n        components.push({ kind: comp[0], gate: comp[1], drain: comp[2], source: comp[3] });\n      } else if (comp[0] === 'probe' || comp[0] === 'wire') {\n        if (comp.length === 1)\n          return this.reportError(lineNum, `${comp[0]} takes a list of nets to monitor, like: ${comp[0]} net0 net1 net2...`);\n        components.push({ kind: comp[0], nets: comp.slice(1) });\n      } else if (comp[0] === 'button') {\n        if (comp.length !== 2)\n          return this.reportError(lineNum, `button takes a single output net, like: button net`);\n        components.push({ kind: 'button', net: comp[1] })\n      } else if (comp[0] === 'signal') {\n        if (comp.length !== 3)\n          return this.reportError(lineNum, 'signal takes a net and a description of the signal, like: signal clock 01... \\nThe signal must be made of 0s and 1s, and may optionally end with ... to indicate that the signal should repeat.');\n        const repeat = comp[2].endsWith('...');\n        if (repeat)\n          comp[2] = comp[2].slice(0, -3);\n        for (const c of comp[2])\n          if (c !== '0' && c !== '1')\n            return this.reportError(lineNum, 'The signal must be made of 0s and 1s, and may optionally end with ... to indicate that the signal should repeat.');\n        components.push({ kind: 'signal', repeat, signal: comp[2], net: comp[1] });\n      } else {\n        return this.reportError(lineNum, `Invalid component: ${comp[0]} (must be one of: nfet, pfet, probe, wire, button, signal)`);\n      }\n    }\n    this.simulate(components);\n  }\n\n  render() {\n    const codeMirrorOptions = (onCompile: (code: string) => void) => ({\n      mode: 'python',\n      theme: 'material',\n      lineNumbers: true,\n      indentUnit: 4,\n      lineWrapping: true,\n      extraKeys: {\n        'Ctrl-Enter': (cm: any) => {\n          onCompile(this.state.code);\n        },\n        'Ctrl-S': (cm: any) => {\n\n        },\n        /*'Tab': (cm: any) => {\n          cm.replaceSelection('  ', 'end');\n        },*/\n      },\n    });\n\n    const vertResizeStyle = {\n      background: 'black',\n      width: '3px',\n      cursor: 'col-resize',\n      height: '100%',\n    };\n    const horizResizeStyle = {\n      background: 'black',\n      height: '3px',\n      cursor: 'row-resize',\n      width: '100%',\n    };\n    let vertSplitDefault = parseInt(localStorage.getItem('split1') || '500');\n    let horizSplitDefault = parseInt(localStorage.getItem('split2') || '400');\n    return <div style={{\n      display: 'flex',\n    }}>\n      {/* Code editor */}\n      <SplitPane\n        split=\"vertical\"\n        minSize={300}\n        defaultSize={vertSplitDefault}\n        onChange={(size) => localStorage.setItem('split1', size.toString())}\n        resizerStyle={vertResizeStyle}\n      >\n        <div>\n          <ControlledCodeMirror\n            value={this.state.code}\n            options={codeMirrorOptions(this.onCompile)}\n            onBeforeChange={(editor, data, code) => {\n              localStorage.setItem('code', code);\n              this.setState({ code });\n            }}\n          />\n        </div>\n\n        <div>\n          <SplitPane\n            split=\"horizontal\"\n            minSize={30}\n            defaultSize={horizSplitDefault}\n            onChange={(size) => localStorage.setItem('split2', size.toString())}\n            resizerStyle={horizResizeStyle}\n          >\n            <div style={{\n              width: '100%',\n              height: '100%',\n              backgroundColor: '#333',\n              color: 'white',\n              fontFamily: 'monospace',\n            }}>\n              <div style={{ margin: 10 }}>\n                {/*\n                {this.state.simResult !== null && <>\n                  <Collapsible trigger='Nets' transitionTime={100}>\n                    {[...this.state.simResult.nets].map((net: any) =>\n                      <div key={net}>\n                        {net}: 1234\n                      </div>\n                    )}\n                  </Collapsible>\n                </>}\n                */}\n\n                {this.state.simResult !== null &&\n                  /*\n                  this.state.simResult.probes.map((probeName) =>\n                    <div key={probeName} style={{display: 'flex', justifyContent: 'center', alignContent: 'center', alignItems: 'center'}}>\n                      <div>{probeName}:</div>\n                      {renderTrace(this.state.simResult!.netTraces.get(probeName)!)}\n                    </div>\n                  )*/\n                  renderTraces(this.state.simResult)\n                }\n              </div>\n            </div>\n\n            <div style={{\n              backgroundColor: '#222',\n              whiteSpace: 'pre-wrap',\n              color: 'white',\n              fontFamily: 'monospace',\n              width: '100%',\n              height: '100%',\n              padding: 10,\n            }}>\n              {this.state.terminalOutput}\n              {'\\n\\n' + this.state.simOutput}\n            </div>\n          </SplitPane>\n        </div>\n      </SplitPane>\n    </div>;\n  }\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}